var a,Mooch={original_xml_http_request:null,original_active_x_object:null,stub_list:null};Mooch.init=function(){!Mooch.original_xml_http_request&&!Mooch.original_active_x_object&&Mooch.replace_XMLHttpRequest();Mooch.stub_list=new Mooch.StubList};Mooch.reset=function(){if(Mooch.original_xml_http_request!==null||Mooch.original_active_x_object!==null)Mooch.restore_XMLHttpRequest();Mooch.stub_list=null};
Mooch.replace_XMLHttpRequest=function(){if(window.XMLHttpRequest){Mooch.original_xml_http_request=window.XMLHttpRequest;window.XMLHttpRequest=Mooch.XMLHttpRequest}if(window.ActiveXObject){Mooch.original_active_x_object=window.ActiveXObject;window.ActiveXObject=Mooch.XMLHttpRequest}};
Mooch.restore_XMLHttpRequest=function(){if(window.XMLHttpRequest){window.XMLHttpRequest=Mooch.original_xml_http_request;Mooch.original_xml_http_request=null}if(window.ActiveXObject){window.ActiveXObject=Mooch.original_active_x_object;Mooch.original_active_x_object=null}};Mooch.stub_request=function(b,c){Mooch.init();return Mooch.stub_list.add(b,c)};
Mooch.console={is_enabled:false,enable:function(){this.is_enabled=true},disable:function(){this.is_enabled=false},log:function(){if(this.is_enabled&&typeof window.console!="undefined"){var b=Array.prototype.slice.call(arguments,0);b.unshift("Mooch:");console.log.apply(console,b)}},warn:function(){if(this.is_enabled&&typeof window.console!="undefined"){var b=Array.prototype.slice.call(arguments,0);b.unshift("Mooch:");console.warn.apply(console,b)}}};
Mooch.Stub=function(b,c){this.method=b;this.uri=c;this.status=200;this.statusText="OK";this.responseText="";this.responseXML=null};Mooch.Stub.prototype={returns:function(b){if(b.status)this.status=b.status;if(b.body)this.responseText=b.body},set_jsonp_callback:function(b){this.jsonp_callback=b},run_jsonp_callback:function(){this.jsonp_callback&&window[this.jsonp_callback](window.eval("("+this.responseText+")"))}};Mooch.StubList=function(){this.items={}};
Mooch.StubList.prototype={add:function(b,c){var d=this.find_or_create(b,c);d.stub=new Mooch.Stub(b,c);return d.stub},find_or_create:function(b,c){b=this.key_for(b,c);this.items[b]||(this.items[b]={stub:null,invocation_count:0});return this.items[b]},find:function(b,c){c=this.remove_cache_parameters(c);jsonp_obj=this.store_and_remove_jsonp_parameters(c);c=jsonp_obj.uri;(b=this.items[this.key_for(b,c)])&&jsonp_obj.jsonp_callback&&b.stub.set_jsonp_callback(jsonp_obj.jsonp_callback);return b},key_for:function(b,
c){return b+"_"+c},remove_cache_parameters:function(b){return b.replace(/_=\d+/,"").replace(/\?$/,"")},store_and_remove_jsonp_parameters:function(b){var c=b.match(/callback=(jsonp\d+|jQuery\w+)/);b={uri:b.replace(/callback=(jsonp\d+|jQuery\w+)/,"callback=?").replace(/\&$/,"")};if(c&&c.length>0)b.jsonp_callback=c[1];return b}};Mooch.XMLHttpRequest=function(){Mooch.console.log("new caught",arguments);this.stub=null};a=Mooch.XMLHttpRequest.prototype;
a.open=function(){Mooch.console.log("open caught",arguments);this.stub=Mooch.stub_list.find(arguments[0],arguments[1])};a.setRequestHeader=function(){Mooch.console.log("setRequestHeader caught",arguments)};a.abort=function(){Mooch.console.log("abort caught")};a.getAllResponseHeaders=function(){Mooch.console.log("getAllResponseHeaders caught")};a.getResponseHeader=function(){Mooch.console.log("getResponseHeader caught",arguments)};a.onreadystatechange=function(){};
a.send=function(){Mooch.console.log("send caught",arguments);this.stub.invocation_count++;this.status=this.stub.stub.status;this.statusText=this.stub.stub.statusText;this.responseText=this.stub.stub.responseText;this.readyState=4;this.responseXML=null;this.stub.stub.run_jsonp_callback();Mooch.console.log("firing jQuery callback");this.onreadystatechange()};
